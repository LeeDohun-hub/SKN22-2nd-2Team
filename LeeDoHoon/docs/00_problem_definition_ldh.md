# EPIC 1. 문제 정의 및 예측 프레임 설정

> **문서 버전**: v1.0  
> **작성자**: 이도훈 (LDH)  
> **작성일**: 2025-12-16  
> **상태**: 확정

---

## 1. 프로젝트 개요

### 1.1 배경
KKBox는 아시아 최대 음악 스트리밍 서비스 중 하나로, 구독 기반 비즈니스 모델을 운영한다.
구독 서비스에서 **고객 이탈(Churn)**은 수익에 직접적인 영향을 미치므로,
이탈 가능성이 높은 고객을 사전에 식별하여 선제적 대응 전략을 수립하는 것이 핵심 과제이다.

### 1.2 프로젝트 목표
1. **이탈 고객 예측**: 머신러닝/딥러닝 모델을 통해 고객의 이탈 여부를 예측
2. **BM 관점 인사이트 도출**: 이탈 원인을 분석하여 비즈니스 액션으로 연결
3. **예측 서비스 배포**: Streamlit 앱을 통한 실시간 Risk Score 제공

---

## 2. 예측 문제 정의

### 2.1 문제 유형
| 항목 | 정의 |
|------|------|
| **문제 유형** | 이진 분류 (Binary Classification) |
| **타겟 변수** | `train_v2.is_churn` |
| **레이블** | `1`: 이탈(Churn), `0`: 유지(Retention) |

### 2.2 비즈니스 질문
> "2017년 3월의 사용자 행동 데이터를 기반으로, 해당 사용자가 이후 서비스를 이탈할 것인지 예측할 수 있는가?"

### 2.3 예측 대상
- **단위**: 개별 사용자 (msno)
- **출력**: 이탈 확률 (0~1) → Risk Score로 활용

---

## 3. 데이터셋 구성

### 3.1 사용 데이터
| 파일명 | 설명 | 용도 |
|--------|------|------|
| `train_v2.csv` | 사용자별 이탈 라벨 | 타겟 변수 (Y) |
| `user_logs_v2.csv` | 일별 음악 청취 로그 | 행동 Feature 생성 |
| `transactions.csv` | 결제/구독 거래 내역 | 결제 Feature 생성 |
| `members_v3.csv` | 사용자 기본 정보 | 정적 Feature |

### 3.2 데이터 규모
- **train_v2.csv**: 약 970,962 users
- **user_logs_v2.csv**: 2017년 3월 (30일간) 로그
- **Key**: `msno` (사용자 고유 ID)

---

## 4. 시간 프레임 설계

### 4.1 예측 타임라인

```
        [관측 윈도우 30일]              [예측 윈도우]
    ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┿━━━━━━━━━━━━━━━━━▶
    │                                  │
2017-03-01                         2017-04-01 (T)
    │                                  │
    └──── Feature 생성 구간 ────┘      └── Churn 발생 여부 ──
```

### 4.2 주요 시점 정의

| 구분 | 값 | 설명 |
|------|-----|------|
| **예측 시점 (T)** | 2017-04-01 | 이 시점까지의 정보만 사용 |
| **관측 윈도우** | 2017-03-01 ~ 2017-03-31 | Feature 생성 구간 (30일) |
| **예측 윈도우** | T 이후 | Churn 라벨에 이미 반영됨 |

### 4.3 시간 제약 근거
- `user_logs_v2.csv`에 2017년 3월 데이터만 존재
- 따라서 관측 윈도우는 최대 30일로 제한

---

## 5. 데이터 사용 원칙

### 5.1 Feature 생성 규칙

| 규칙 | 설명 |
|------|------|
| ✅ **T 이전 데이터만 사용** | 2017-04-01 이전 데이터로만 Feature 생성 |
| ✅ **관측 윈도우 내 집계** | 30일간의 로그를 사용자별로 집계 |
| ❌ **미래 정보 누수 금지** | T 이후 데이터는 절대 사용하지 않음 |

### 5.2 테이블별 사용 범위

| 테이블 | 사용 범위 |
|--------|-----------|
| `user_logs_v2` | 관측 윈도우 (03-01 ~ 03-31) 내 데이터만 |
| `transactions` | T (04-01) 이전 모든 거래 내역 |
| `members_v3` | 정적 정보 (시간 독립적) |

### 5.3 정적 Feature 예외 허용
다음 정보는 시간에 독립적인 정적 속성으로 사용 가능:

- `members_v3.gender`
- `members_v3.registered_via`
- `members_v3.registration_init_time` → **가입 후 경과 일수**로 변환

---

## 6. 데이터 조인 전략

### 6.1 조인 원칙
```
train_v2 (기준)
    ├── LEFT JOIN user_logs_v2 (집계)
    ├── LEFT JOIN transactions (집계)
    └── LEFT JOIN members_v3
```

### 6.2 데이터 구조
- **최종 형태**: 1 user = 1 row
- **기준 테이블**: `train_v2` (모든 user 포함)
- **조인 방식**: LEFT JOIN (데이터 없는 user도 유지)

### 6.3 결측치 처리 원칙
- 관측 윈도우 내 활동이 없는 사용자:
  - ❌ 삭제하지 않음
  - ✅ 수치형: 0으로 채움
  - ✅ 범주형: "unknown" 또는 최빈값
- **해석**: "최근 30일간 활동 없음" = 유의미한 이탈 신호

---

## 7. 평가 지표

### 7.1 주요 지표
| 지표 | 설명 | 우선순위 |
|------|------|----------|
| **ROC-AUC** | 전체 분류 성능 | ⭐ Primary |
| **PR-AUC** | 불균형 데이터 성능 | ⭐ Primary |
| **Recall** | 이탈자 탐지율 | Secondary |
| **Precision** | 예측 정확도 | Secondary |

### 7.2 비즈니스 관점 지표
- **Risk Score 분포**: 고위험/중위험/저위험 구간별 분포
- **실제 이탈률 vs 예측 확률**: Calibration 검증

---

## 8. 확정 사항 요약

| 항목 | 확정값 |
|------|--------|
| 문제 유형 | 이진 분류 |
| 타겟 변수 | `is_churn` (1=이탈, 0=유지) |
| 예측 시점 (T) | 2017-04-01 |
| 관측 윈도우 | 2017-03-01 ~ 2017-03-31 (30일) |
| 데이터 기준 테이블 | `train_v2` |
| 조인 방식 | LEFT JOIN |
| 주요 평가 지표 | ROC-AUC, PR-AUC |

---

## 9. 다음 단계 (EPIC 2 Preview)

EPIC 1 확정 후, 다음 단계에서는:

1. **스키마 분석**: 각 테이블 구조 및 컬럼 상세 파악
2. **EDA**: 데이터 분포, 결측치, 이상치 탐색
3. **Churn 비율 확인**: 클래스 불균형 정도 파악
4. **Feature 후보 도출**: BM 관점 이탈 신호 정의

---

## 부록: 프로젝트 폴더 구조

```
LeeDoHoon/
├── data/
│   ├── train_v2.csv
│   ├── user_logs_v2.csv
│   ├── transactions.csv
│   └── members_v3.csv
├── docs/
│   └── 00_problem_definition_ldh.md  ← 이 문서
├── notebooks/
├── src/
├── kkbox_github_issues_plan.md
├── requirements.txt
└── README.md
```

---

> **📌 본 문서 이후 단계에서는 위 기준을 변경하지 않는다.**

