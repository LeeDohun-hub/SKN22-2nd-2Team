# 03. ì „ì²˜ë¦¬ ìš”ì•½ (Preprocessing Summary)

> **ì‘ì„±ì**: ì´ë„í›ˆ (LDH)  
> **ì‘ì„±ì¼**: 2025-12-16  
> **ë²„ì „**: v1.0

---

## 1. ì „ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸ ê°œìš”

```
Raw Data
    â”‚
    â”œâ”€â”€ train_v2.csv (97ë§Œ users)
    â”œâ”€â”€ user_logs_v2.csv (2017ë…„ 3ì›”, 30ì¼)
    â”œâ”€â”€ transactions_v2.csv (2015~2017ë…„, ì•½ 2ë…„)
    â””â”€â”€ members_v3.csv (ì •ì  ì •ë³´)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ë‚ ì§œ í˜•ì‹ ë³€í™˜                        â”‚
â”‚  2. ê´€ì¸¡ ìœˆë„ìš° í•„í„°ë§                    â”‚
â”‚  3. Feature Engineering (ì§‘ê³„)           â”‚
â”‚  4. ë°ì´í„° ë³‘í•© (LEFT JOIN)              â”‚
â”‚  5. ê²°ì¸¡ì¹˜/ì´ìƒì¹˜ ì²˜ë¦¬                    â”‚
â”‚  6. ë²”ì£¼í˜• ì¸ì½”ë”©                         â”‚
â”‚  7. Train/Valid/Test ë¶„í•                 â”‚
â”‚  8. Sanity Check                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
Output
    â”œâ”€â”€ feature_table_ldh.csv (ì „ì²´)
    â”œâ”€â”€ train_set.csv (70%)
    â”œâ”€â”€ valid_set.csv (10%)
    â””â”€â”€ test_set.csv (20%)
```

---

## 2. ì‹œê°„ í”„ë ˆì„ ì ìš©

| ë°ì´í„° | í•„í„° ì¡°ê±´ | ì‚¬ìš© ê¸°ê°„ | ë¹„ê³  |
|--------|-----------|-----------|------|
| `user_logs_v2` | 2017-03-01 ~ 2017-03-31 | **30ì¼** | ê´€ì¸¡ ìœˆë„ìš° ì—„ê²© ì ìš© |
| `transactions_v2` | < 2017-04-01 (T) | **ì•½ 2ë…„** | ì „ì²´ ê±°ë˜ ì´ë ¥ í™œìš© |
| `members_v3` | ì œí•œ ì—†ìŒ | ì „ì²´ | ì •ì  ì •ë³´ |

---

## 3. ê²°ì¸¡ì¹˜ ë° ì´ìƒì¹˜ ì²˜ë¦¬ ê·œì¹™

### 3.1 ì´ìƒì¹˜ ì²˜ë¦¬

| ì»¬ëŸ¼ | ê·œì¹™ | ì²˜ë¦¬ ë°©ë²• | ì‚¬ìœ  |
|------|------|-----------|------|
| `age (bd)` | 0 < age < 100 | ë²”ìœ„ ì™¸ â†’ **ì¤‘ì•™ê°’ ëŒ€ì²´** | ë¹„í˜„ì‹¤ì ì¸ ë‚˜ì´ê°’ ì œê±° |

### 3.2 ê²°ì¸¡ì¹˜ ì²˜ë¦¬

| ì»¬ëŸ¼ | ì²˜ë¦¬ ë°©ë²• | ì‚¬ìœ  |
|------|-----------|------|
| `gender` | NaN â†’ **"unknown"** | ë¯¸ì…ë ¥ ì‚¬ìš©ì ë³„ë„ ë²”ì£¼ |
| `city` | NaN â†’ **0** | ë¯¸ì…ë ¥ì„ 0ìœ¼ë¡œ ì²˜ë¦¬ |
| `registered_via` | NaN â†’ **0** | ë¯¸ì…ë ¥ì„ 0ìœ¼ë¡œ ì²˜ë¦¬ |
| **ìˆ˜ì¹˜í˜• ì „ì²´** | NaN â†’ **0** | í™œë™/ê±°ë˜ ì—†ìŒ = ì˜ë¯¸ìˆëŠ” ì‹ í˜¸ |

### 3.3 ì²˜ë¦¬ ì›ì¹™
- **ì‚­ì œí•˜ì§€ ì•ŠìŒ**: ê²°ì¸¡ì¹˜ê°€ ìˆëŠ” í–‰ì„ ì‚­ì œí•˜ì§€ ì•Šê³  ëª¨ë“  ì‚¬ìš©ì ìœ ì§€
- **0ì˜ ì˜ë¯¸**: "ìµœê·¼ 30ì¼ê°„ í™œë™ ì—†ìŒ"ì€ ì´íƒˆ ì‹ í˜¸ë¡œ í•´ì„

---

## 4. Feature Engineering ìš”ì•½

### 4.1 User Log Features (16ê°œ)

30ì¼ ê´€ì¸¡ ìœˆë„ìš° ë‚´ í–‰ë™ ë°ì´í„° ì§‘ê³„

| í”¼ì²˜ ìœ í˜• | í”¼ì²˜ ìˆ˜ | ì˜ˆì‹œ |
|-----------|---------|------|
| ì§‘ê³„ í”¼ì²˜ | 9ê°œ | `total_songs`, `active_days`, `num_unq_sum` |
| ë¹„ìœ¨ í”¼ì²˜ | 4ê°œ | `skip_ratio`, `complete_ratio`, `partial_ratio` |
| í‰ê·  í”¼ì²˜ | 3ê°œ | `avg_songs_per_day`, `avg_secs_per_day` |

### 4.2 Transaction Features (13ê°œ)

ì•½ 2ë…„ê°„ ê²°ì œ ì´ë ¥ ì§‘ê³„

| í”¼ì²˜ ìœ í˜• | í”¼ì²˜ ìˆ˜ | ì˜ˆì‹œ |
|-----------|---------|------|
| ê¸ˆì•¡ í”¼ì²˜ | 4ê°œ | `total_payment`, `avg_payment`, `avg_discount_rate` |
| íšŸìˆ˜ í”¼ì²˜ | 2ê°œ | `transaction_count`, `cancel_count` |
| ìµœê·¼ ê±°ë˜ | 4ê°œ | `is_auto_renew_last`, `days_to_expire` |
| í”Œë˜ê·¸ | 3ê°œ | `has_cancelled`, `auto_renew_rate` |

### 4.3 Member Features (6ê°œ â†’ ì¸ì½”ë”© í›„ 8ê°œ)

ì •ì  ì‚¬ìš©ì ì •ë³´

| í”¼ì²˜ | ì¸ì½”ë”© | ê²°ê³¼ |
|------|--------|------|
| `gender` | One-hot | `gender_female`, `gender_male`, `gender_unknown` |
| `city` | ê·¸ëŒ€ë¡œ | ìˆ˜ì¹˜í˜•ìœ¼ë¡œ ì²˜ë¦¬ |
| `registered_via` | ê·¸ëŒ€ë¡œ | ìˆ˜ì¹˜í˜•ìœ¼ë¡œ ì²˜ë¦¬ |
| `age` | ì´ìƒì¹˜ ì²˜ë¦¬ | ì¤‘ì•™ê°’ ëŒ€ì²´ |
| `tenure_days` | ê³„ì‚° | T ê¸°ì¤€ ê°€ì… í›„ ê²½ê³¼ ì¼ìˆ˜ |

---

## 5. ë°ì´í„° ë¶„í• 

### 5.1 ë¶„í•  ë¹„ìœ¨

| ì…‹ | ë¹„ìœ¨ | ìš©ë„ |
|----|------|------|
| **Train** | 70% | ëª¨ë¸ í•™ìŠµ |
| **Valid** | 10% | í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹ |
| **Test** | 20% | ìµœì¢… ì„±ëŠ¥ í‰ê°€ |

### 5.2 ë¶„í•  ë°©ì‹
- **Stratified Split**: Churn ë¹„ìœ¨ ìœ ì§€
- **Random State**: 42 (ì¬í˜„ì„± ë³´ì¥)

---

## 6. Sanity Check í•­ëª©

| ì²´í¬ í•­ëª© | ê¸°ëŒ€ê°’ |
|-----------|--------|
| ê²°ì¸¡ì¹˜ | 0ê°œ |
| ì¤‘ë³µ msno | 0ê°œ |
| ìˆ˜ì¹˜í˜• ìŒìˆ˜ê°’ | í—ˆìš© (`days_to_expire` ì œì™¸í•˜ê³  ì—†ì–´ì•¼ í•¨) |
| ë¬´í•œê°’ | 0ê°œ |
| Churn ë¹„ìœ¨ | Train/Valid/Test ë™ì¼ |

---

## 7. ìµœì¢… ë°ì´í„°ì…‹ ìŠ¤í™

### 7.1 ì»¬ëŸ¼ ìˆ˜
- **ì…ë ¥ í”¼ì²˜**: ì•½ 35~40ê°œ
- **íƒ€ê²Ÿ**: `is_churn` (1ê°œ)
- **ID**: `msno` (1ê°œ)

### 7.2 í–‰ ìˆ˜
| ì…‹ | ì˜ˆìƒ í–‰ ìˆ˜ |
|----|------------|
| ì „ì²´ | ì•½ 970,962 |
| Train | ì•½ 679,673 (70%) |
| Valid | ì•½ 97,096 (10%) |
| Test | ì•½ 194,193 (20%) |

---

## 8. ì‹¤í–‰ ë°©ë²•

```bash
# ê°€ìƒí™˜ê²½ í™œì„±í™”
conda activate project-2nd

# ì „ì²˜ë¦¬ ì‹¤í–‰
python src/preprocessing_ldh.py
```

### ì¶œë ¥ íŒŒì¼
```
data/
â”œâ”€â”€ feature_table_ldh.csv    # ì „ì²´ í”¼ì²˜ í…Œì´ë¸”
â”œâ”€â”€ train_set.csv            # í•™ìŠµ ë°ì´í„°
â”œâ”€â”€ valid_set.csv            # ê²€ì¦ ë°ì´í„°
â”œâ”€â”€ test_set.csv             # í…ŒìŠ¤íŠ¸ ë°ì´í„°
â””â”€â”€ feature_dictionary.csv   # í”¼ì²˜ ì‚¬ì „
```

---

## 9. ì£¼ì˜ì‚¬í•­

1. **ë¯¸ë˜ ì •ë³´ ëˆ„ìˆ˜ ê¸ˆì§€**: T (2017-04-01) ì´í›„ ë°ì´í„°ëŠ” ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
2. **ê²°ì¸¡ì¹˜ = ì‹ í˜¸**: í™œë™ ì—†ëŠ” ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ì§€ ì•ŠìŒ
3. **ì¬í˜„ì„±**: `random_state=42`ë¡œ ë¶„í•  ê²°ê³¼ ê³ ì •

---

> **ğŸ“Œ ë³¸ ì „ì²˜ë¦¬ ê²°ê³¼ëŠ” EPIC 1ì—ì„œ ì •ì˜í•œ ì›ì¹™ì„ ì¤€ìˆ˜í•©ë‹ˆë‹¤.**

